# Abstracted Phase UI - Visual Guide

## The User Experience

When a user asks: *"Why are college grads struggling to find jobs compared to 2018?"*

### What They See

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  AI Team Collaborating                            [Hide]      â”‚
â”‚    Step 1 of 5 â€” Understanding your query                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â—† Understanding your query         Â· GPT          âœ“ 6.0s      â”‚
â”‚   Clarifying timeframeâ€¦ designing structureâ€¦                   â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Researching recent data           Â· Perplexity  âŠ— Pending  â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Refining and organizing           Â· GPT         âŠ— Pending  â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Cross-checking with other AIs     Â· Council     âŠ— Pending  â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Synthesizing final report         Â· GPT         âŠ— Pending  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[... a few seconds pass ...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  AI Team Collaborating                            [Hide]      â”‚
â”‚    Step 2 of 5 â€” Researching recent data                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Understanding your query         Â· GPT          âœ“ 6.0s      â”‚
â”‚                                                                 â”‚
â”‚ â—† Researching recent data           Â· Perplexity  âŠ™ Thinking â”‚
â”‚   Pulling labor market statsâ€¦ unemployment trendsâ€¦             â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Refining and organizing           Â· GPT         âŠ— Pending  â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Cross-checking with other AIs     Â· Council     âŠ— Pending  â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Synthesizing final report         Â· GPT         âŠ— Pending  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[... research completes ...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  AI Team Collaborating                            [Hide]      â”‚
â”‚    Step 4 of 5 â€” Cross-checking with other AI models           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Understanding your query         Â· GPT          âœ“ 6.0s      â”‚
â”‚ âœ“ Researching recent data           Â· Perplexity  âœ“ 4.1s      â”‚
â”‚ âœ“ Refining and organizing           Â· GPT         âœ“ 5.2s      â”‚
â”‚                                                                 â”‚
â”‚ â—† Cross-checking with other AIs                                â”‚
â”‚   Perplexity, Gemini, GPT, Kimi, OpenRouter                   â”‚
â”‚   3/5 reviews complete                                         â”‚
â”‚   âœ“ 2 agree    â—† 1 mixed    âœ• 0 disagree                      â”‚
â”‚                                                                 â”‚
â”‚ â—‡ Synthesizing final report         Â· GPT         âŠ— Pending  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[... all reviews complete ...]

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ğŸ§  AI Team Collaborating                            [Hide]      â”‚
â”‚    Step 5 of 5 â€” Synthesizing final report                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ âœ“ Understanding your query         Â· GPT          âœ“ 6.0s      â”‚
â”‚ âœ“ Researching recent data           Â· Perplexity  âœ“ 4.1s      â”‚
â”‚ âœ“ Refining and organizing           Â· GPT         âœ“ 5.2s      â”‚
â”‚ âœ“ Cross-checking with other AIs     Â· Council     âœ“ 7.8s      â”‚
â”‚                                                                 â”‚
â”‚ â—† Synthesizing final report         Â· GPT         âŠ™ Thinking â”‚
â”‚   Merging internal reasoning and external reviewsâ€¦             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[... synthesis completes ...]
```

### Then the Final Answer Appears

```
Today's college undergraduates face a significantly tougher job market
than their 2018 counterparts, driven by:

1. RISING UNEMPLOYMENT & UNDEREMPLOYMENT
   â€¢ Unemployment for Class of 2023: 4.2% (vs 2.3% in 2018)
   â€¢ Underemployment: 52% (up from 43%)
   â€¢ "Working at coffee shop with degree" phenomenon widespread

[... complete answer with tables and graphs ...]
```

---

## Backend Event Stream (Raw)

```json
=== Phase 1: "understand" (Understanding your query) ===

â†’ phase_start
{
  "type": "phase_start",
  "run_id": "run_abc123",
  "timestamp": "2025-11-30T18:00:00.000Z",
  "phase": "understand",
  "label": "Understanding your query",
  "model_display": "GPT-4.1",
  "step_index": 0
}

  â†’ stage_start (analyst)
  {
    "type": "stage_start",
    "role": "analyst",
    "label": "Analyst",
    "model_display": "GPT-4.1",
    "step_index": 0
  }

  â†’ phase_delta
  {
    "type": "phase_delta",
    "phase": "understand",
    "text_delta": "Clarifying timeframe (2018â€“2025) and focus..."
  }

  â†’ stage_end (analyst)
  {
    "type": "stage_end",
    "role": "analyst",
    "latency_ms": 3200
  }

  â†’ stage_start (creator)
  {
    "type": "stage_start",
    "role": "creator",
    "label": "Creator",
    "model_display": "GPT-4.1",
    "step_index": 2
  }

  â†’ phase_delta
  {
    "type": "phase_delta",
    "phase": "understand",
    "text_delta": "Designing answer structure: intro, sections..."
  }

  â†’ stage_end (creator)
  {
    "type": "stage_end",
    "role": "creator",
    "latency_ms": 2800
  }

â† phase_end
{
  "type": "phase_end",
  "phase": "understand",
  "latency_ms": 6000
}


=== Phase 2: "research" (Researching recent data) ===

â†’ phase_start
{
  "type": "phase_start",
  "phase": "research",
  "label": "Researching recent data and trends",
  "model_display": "Perplexity Sonar",
  "step_index": 1
}

  â†’ stage_start (researcher)
  {
    "type": "stage_start",
    "role": "researcher",
    "label": "Researcher",
    "model_display": "Perplexity Sonar",
    "step_index": 1
  }

  â†’ phase_delta
  {
    "type": "phase_delta",
    "phase": "research",
    "text_delta": "Pulling stats on unemployment (4.2%), underemployment..."
  }

  â†’ stage_end (researcher)
  {
    "type": "stage_end",
    "role": "researcher",
    "latency_ms": 4100
  }

â† phase_end
{
  "type": "phase_end",
  "phase": "research",
  "latency_ms": 4100
}


=== Phase 3: "reason_refine" (Refining and organizing) ===

â†’ phase_start
{
  "type": "phase_start",
  "phase": "reason_refine",
  "label": "Refining and organizing the answer",
  "model_display": "GPT-4.1",
  "step_index": 2
}

  [... stage events for critic and internal_synth ...]

â† phase_end
{
  "type": "phase_end",
  "phase": "reason_refine",
  "latency_ms": 5200
}


=== Phase 4: "crosscheck" (Cross-checking with other AIs) ===

â†’ phase_start
{
  "type": "phase_start",
  "phase": "crosscheck",
  "label": "Cross-checking with other AI models",
  "model_display": "Perplexity, Gemini, GPT, Kimi, OpenRouter",
  "step_index": 3
}

  â†’ stage_start (council)

  â†’ council_progress
  {
    "type": "council_progress",
    "completed": 1,
    "total": 5,
    "stance_counts": {
      "agree": 1,
      "mixed": 0,
      "disagree": 0
    }
  }

  â†’ council_progress
  {
    "type": "council_progress",
    "completed": 3,
    "total": 5,
    "stance_counts": {
      "agree": 2,
      "mixed": 1,
      "disagree": 0
    }
  }

  â†’ council_progress
  {
    "type": "council_progress",
    "completed": 5,
    "total": 5,
    "stance_counts": {
      "agree": 3,
      "mixed": 2,
      "disagree": 0
    }
  }

  â†’ stage_end (council)

â† phase_end
{
  "type": "phase_end",
  "phase": "crosscheck",
  "latency_ms": 7800
}


=== Phase 5: "synthesize" (Synthesizing final report) ===

â†’ phase_start
{
  "type": "phase_start",
  "phase": "synthesize",
  "label": "Synthesizing final report",
  "model_display": "GPT-4.1 (Director)",
  "step_index": 4
}

  â†’ stage_start (director)

  â†’ phase_delta
  {
    "type": "phase_delta",
    "phase": "synthesize",
    "text_delta": "Merging internal reasoning and external reviews..."
  }

  [... final_answer_delta events (character by character) ...]

  â†’ final_answer_delta
  {
    "type": "final_answer_delta",
    "text_delta": "Today's college undergraduates face a..."
  }

  â†’ final_answer_delta
  {
    "type": "final_answer_delta",
    "text_delta": " significantly tougher job market than..."
  }

  [... more deltas ...]

  â†’ final_answer_done
  {
    "type": "final_answer_done",
    "response": {
      "final_answer": {
        "content": "Today's college undergraduates...[full answer]...",
        "model": {"provider": "openai", "model_slug": "gpt-4.1"},
        "created_at": "2025-11-30T18:00:12.000Z"
      },
      "internal_pipeline": {
        "stages": [
          {"role": "analyst", "content": "..."},
          {"role": "researcher", "content": "..."},
          ...
        ]
      },
      "external_reviews": [
        {"source": "perplexity", "stance": "agree", "content": "..."},
        ...
      ],
      "meta": {
        "run_id": "run_abc123",
        "total_latency_ms": 26100,
        "models_involved": [...]
      }
    }
  }

â† phase_end
{
  "type": "phase_end",
  "phase": "synthesize",
  "latency_ms": 8500
}
```

---

## Frontend State Management

### Using useThinkingState Hook

```typescript
// Initial state (before any events)
{
  steps: [
    { phase: "understand", label: "Understanding your query", status: "pending", preview: "" },
    { phase: "research", label: "Researching recent data...", status: "pending", preview: "" },
    { phase: "reason_refine", label: "Refining and organizing...", status: "pending", preview: "" },
    { phase: "crosscheck", label: "Cross-checking with other AIs...", status: "pending", preview: "" },
    { phase: "synthesize", label: "Synthesizing final report", status: "pending", preview: "" }
  ],
  currentIndex: 0,
  councilSummary: undefined,
  isCollapsed: false
}

// After phase_start (understand)
{
  steps: [
    {
      phase: "understand",
      label: "Understanding your query",
      modelDisplay: "GPT-4.1",
      status: "active",
      preview: ""
    },
    // ... (others unchanged)
  ],
  currentIndex: 0
}

// After phase_delta events accumulate
{
  steps: [
    {
      phase: "understand",
      label: "Understanding your query",
      modelDisplay: "GPT-4.1",
      status: "active",
      preview: "Clarifying timeframe... Designing answer structure..."
    },
    // ...
  ]
}

// After phase_end (understand)
{
  steps: [
    {
      phase: "understand",
      label: "Understanding your query",
      modelDisplay: "GPT-4.1",
      status: "done",
      latency_ms: 6000,
      preview: "..."
    },
    {
      phase: "research",
      label: "Researching recent data...",
      modelDisplay: "Perplexity Sonar",
      status: "active",
      preview: ""
    },
    // ...
  ],
  currentIndex: 1
}

// After council_progress events
{
  councilSummary: {
    completed: 3,
    total: 5,
    stanceCounts: {
      agree: 2,
      mixed: 1,
      disagree: 0
    }
  }
}

// Final state (after phase_end synthesize)
{
  steps: [
    { phase: "understand", status: "done", latency_ms: 6000, ... },
    { phase: "research", status: "done", latency_ms: 4100, ... },
    { phase: "reason_refine", status: "done", latency_ms: 5200, ... },
    { phase: "crosscheck", status: "done", latency_ms: 7800, ... },
    { phase: "synthesize", status: "done", latency_ms: 8500, ... }
  ],
  currentIndex: 4
}
```

---

## Timeline: Events â†’ UI Update â†’ User Sees

```
Time  Backend                         Frontend State              User Sees
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

0ms   phase_start (understand)        â†’ currentIndex = 0          â—‡ â—‡ â—‡ â—‡ â—‡
                                      â†’ status = active           Step 1: Understanding

100ms phase_delta                     â†’ preview updated          (blank)
      Clarifying timeframe...

2000ms phase_delta                    â†’ preview updated          Clarifying...
       Designing structure...

3200ms stage_end (analyst)
      (internal only)

4000ms phase_delta                    â†’ preview updated          Clarifying... Designing...
       Designing structure...

6000ms phase_end (understand)         â†’ status = done            âœ“ Understanding (6.0s)
                                      â†’ currentIndex = 1         â—† Researching...
                                      â†’ status = active

6100ms phase_start (research)         â†’ step[1].status = active  Step 2: Researching
       Perplexity

6200ms phase_delta                    â†’ preview updated          (blank)
       Pulling stats...

10100ms phase_end (research)          â†’ status = done            âœ“ Researching (4.1s)
                                      â†’ currentIndex = 2         â—† Refining...

... (reason_refine and crosscheck phases)

25300ms phase_start (synthesize)      â†’ status = active          Step 5: Synthesizing
        GPT Director                  â†’ currentIndex = 4         âŠ™ Merging reasoning...

25400ms phase_delta                   â†’ preview = "Merging..."
        Merging internal reasoning...

25500ms final_answer_delta            â†’ answer += "Today's"      Final answer starts
        Today's                                                    appearing in bubble

26000ms final_answer_delta            â†’ answer += " college..."
        college...

... (more deltas for 5+ seconds)

34000ms final_answer_done             â†’ response stored          Final answer complete
        {response: {...}}              â†’ UI can show details      All phases marked done

34000ms phase_end (synthesize)        â†’ status = done            Thinking strip collapsed
                                      â†’ all steps status = done   Final answer displayed
```

---

## TypeScript Type Flow

```typescript
// Event comes from backend as JSON string
const jsonString = '{"type":"phase_start","phase":"understand",...}'

// Parse it
const event = parseCollaborateEvent(jsonString)
// â†’ PhaseStartEvent { type: "phase_start", phase: "understand", ... }

// Process with hook
thinking.handleEvent(event)
// â†’ Dispatch "PHASE_START" action

// Reducer updates state
const newState = thinkingReducer(state, {
  type: "PHASE_START",
  phase: "understand",
  label: "Understanding your query",
  modelDisplay: "GPT-4.1",
  stepIndex: 0
})

// ThinkingStrip receives updated steps
<ThinkingStrip
  steps={newState.steps}  // Array of ThinkingStep with phase: AbstractPhase
  currentIndex={newState.currentIndex}
/>

// Component renders 5 phases
```

---

## Key Differences: Old vs New

| Aspect | Old (7 Stages) | New (5 Phases) |
|--------|---|---|
| **Event Types** | `stage_*` only | `phase_*` + `stage_*` |
| **UI Complexity** | 7 steps shown | 5 steps shown |
| **Step Key** | `role: "analyst"` | `phase: "understand"` |
| **Model Display** | Single per role | "Perplexity, Gemini, GPT..." for council |
| **Status Bar** | "Step 2 of 7" | "Step 2 of 5" |
| **Preview** | One preview per role | One preview per phase (accumulates) |
| **Council View** | Separate step | Integrated into crosscheck phase |
| **Hook Usage** | `useThinkingState()` | `useThinkingState()` or `usePhaseCollaboration()` |

---

## Summary

The abstracted phase UI provides:

âœ… **Clean User Experience**
- 5 clear phases instead of 7 confusing roles
- Obvious model involvement
- Smooth animated progress

âœ… **Powerful Backend**
- Still runs full 7-step internal pipeline
- All detailed events logged for observability
- Can evolve internal process without UI changes

âœ… **Full Transparency**
- Users see exactly which models are involved
- Council review progress visible
- Timing breaks down per phase
- Final answer fully sourced

